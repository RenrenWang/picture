<%- include top %>
<div id="header" class="" style="left: 0px;">
	<div class="wrapper" style="width: 1244px;">
		<div class="menu-bar">
			<div class="left-part">
				<a id="huaban" href="/"></a>
				<a href="/" data-title="home" class="header-item active">首页</a>
				<a href="/discovery/" class="header-item ">发现</a>
				<a href="/all/" class="header-item ">最新</a>
				<a href="https://muse.huaban.com/" class="header-item meisi">美思<i class="muse entrance"></i></a>
				<a href="http://meia.me" target="_blank" class="header-item">教育</a>
				<div class="menu-nav">
					<div class="header-main-menu" style="display: none;">
						<div class="top-module">
							<a href="/apps/" rel="nofollow" class="text app-link">移动应用</a>
							<a href="/about/goodies/" rel="nofollow" class="text app-link">采集工具</a>
							<a href="/activities/" rel="nofollow" class="text pin-link">活动</a>
						</div>
						<div id="category_more" class="middle-module clearfix">
							<div class="col-1 col">
								<a href="/favorite/web_app_icon/" rel="nofollow" data-id="web_app_icon" class="category-link">UI/UX</a>
								<a href="/favorite/design/" rel="nofollow" data-id="design" class="category-link">平面</a>
								<a href="/favorite/illustration/" rel="nofollow" data-id="illustration" class="category-link">插画/漫画</a>
								<a href="/favorite/home/" rel="nofollow" data-id="home" class="category-link">家居/家装</a>
								<a href="/favorite/apparel/" rel="nofollow" data-id="apparel" class="category-link">女装/搭配</a>
							</div>
							<div class="col-2 col">
								<a href="/favorite/men/" rel="nofollow" data-id="men" class="category-link">男士/风尚</a>
								<a href="/favorite/wedding_events/" rel="nofollow" data-id="wedding_events" class="category-link">婚礼</a>
								<a href="/favorite/industrial_design/" rel="nofollow" data-id="industrial_design" class="category-link">工业设计</a>
								<a href="/favorite/photography/" rel="nofollow" data-id="photography" class="category-link">摄影</a>
								<a href="/categories/" rel="nofollow" data-id="more" class="all-categories-link category-link">兴趣/生活 »</a>
							</div>
						</div>

					</div>
				</div>
			</div>
			<div class="right-part">
				<a style="display: none" href="#" onclick="return false;" class="go-mobile btn rbtn"><span class="text"> 访问移动版</span></a>

				<div id="nav_user">
					<a href="/w1123224/" class="nav-link dm-nav"><img width="26" height="26" src="//img.hb.aicdn.com/eead355b732f022f1fb52a00528c25bb4386a3621265-qQOGuE_sq75sf" data-baiduimageplus-ignore="1" class="avt">
						<div class="arrow"></div>
						<div class="num ">1</div>
					</a>

				</div>
			</div>

			<div class="search-hint"></div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="/css/webuploader.css" />
<div class="add-content">
	<div class="container">
		<h3>
			作品上传
		</h3>
		<form class="add-from">
			<div class="input-group">
				<label class="clear-label">描述：</label>
				<textarea rows="3" class="textarea clear-input" name="description"></textarea>
			</div>

			<div class="input-group">
				<label class="clear-label">图片：</label>
				<!--dom结构部分-->
				<div id="uploader-demo" style="display: inline-block;vertical-align: middle;">

					<div id="filePicker" class="btn">选择图片</div>

				</div>
				<!--用来存放item-->
				<div id="fileList" class="uploader-list" style="margin-left: 48px;"></div>
			</div>
			<div class="input-group">
				<label class="clear-label">分类：</label>
				<select class="select clear-input" name="kind">
					<option value="0">素描</option>
					<option value="1">色彩</option>
					<option value="2">速写</option>
				</select>
			</div>
			<div class="input-group">
				<label class="clear-label">是否公开：</label>
				<label class="radio-inline">
                    <input type="radio" name="open" value="1" checked> 是
                 </label>
				<label class="radio-inline">
                    <input type="radio" name="open"  value="-1"> 否
                </label>
			</div>
			<a href="javascript:;" class="btn  up-save" id="up-save">提交</a>
		</form>
	</div>
</div>
<%- include footer %>
<script src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/webuploader.min.js"></script>
<script>
	$('#header').addClass('active');
	$('.logo a').addClass('logoActive');
	$('#login').removeClass('alogin');
	$('#up-save').click(function() {
		var description = $("textarea[name='description']").val();
		var kind = $("select[name='kind']").val();
		var open = $("input:radio[name='open']:checked").val();
		$.ajax({
			type: "post",
			url: '/imgs/add/text',
			data: { "description": description, "kind": kind, "open": open },
			async: true,
			success: function(data) {
				if(data.status == 1) {
					window.location.href = "/users/personal/" + data.user_id;
				} else if(data.status == 0) {
					alert(data.error);
				}
				//alert(data.status);
			}
		})
	});

	var uploader = WebUploader.create({

		// 选完文件后，是否自动上传。
		auto: true,

		// swf文件路径
		swf: '/js/Uploader.swf',

		// 文件接收服务端。
		server: '/imgs/add/img',

		// 选择文件的按钮。可选。
		// 内部根据当前运行是创建，可能是input元素，也可能是flash.
		pick: '#filePicker',

		// 只允许选择图片文件。
		accept: {
			title: 'Images',
			extensions: 'jpg,jpeg,png',
			mimeTypes: 'image/jpg,image/jpeg,image/png' //修改这行
		}
	});
	// 当有文件添加进来的时候
	uploader.on('fileQueued', function(file) {
		var $li = $(
				'<div id="' + file.id + '" class="file-item thumbnail">' +
				'<img>' +
				'<div class="info">' + file.name + '</div>' +
				'</div>'
			),
			$img = $li.find('img');

		// $list为容器jQuery实例
		$('#fileList').append($li);

		// 创建缩略图
		// 如果为非图片文件，可以不用调用此方法。
		// thumbnailWidth x thumbnailHeight 为 100 x 100
		uploader.makeThumb(file, function(error, src) {
			if(error) {
				$img.replaceWith('<span>不能预览</span>');
				return;
			}

			$img.attr('src', src);
		}, 100, 100);
	});

	// 文件上传失败，显示上传出错。
	uploader.on('uploadError', function(file) {
		var $li = $('#' + file.id),
			$error = $li.find('div.uploaderror');

		// 避免重复创建
		if(!$error.length) {
			$error = $('<div class="uploaderror"></div>').appendTo($li);
		}

		$error.text('上传失败');
	});
</script>
</body>

</html>
